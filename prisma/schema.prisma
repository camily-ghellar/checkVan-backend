generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model user {
  id             Int       @id @default(autoincrement())
  email          String    @unique @db.VarChar(255)
  password       String    @db.VarChar(255)
  name           String    @db.VarChar(255)
  phone          String?   @db.VarChar(15)
  birth_date     DateTime? @db.Date
  role           String    @db.VarChar(20)
  driver_license String?   @db.VarChar(20)
  
  students       student[]        @relation("guardian_students") 
  teams          team[]           @relation("driver_teams")      
}

model school {
  id        Int       @id @default(autoincrement())
  name      String    @db.VarChar(255)
  address   String?   @db.VarChar(255)
  latitude  Float?
  longitude Float?

  students  student[]
  trips     trip[]
}

model student {
  id             Int      @id @default(autoincrement())
  name           String   @db.VarChar(255)
  birth_date     DateTime @db.Date
  gender         String   @db.VarChar(255)
  guardian_id    Int
  school_id      Int
  address        String?  @db.VarChar(255)
  latitude       Float?
  longitude      Float?
  is_going_today Boolean  @default(false)

  user         user    @relation("guardian_students", fields: [guardian_id], references: [id])
  school       school  @relation(fields: [school_id], references: [id])
  student_team student_team[]
}

model trip {
  id             Int       @id @default(autoincrement())
  departure_time DateTime?
  arrival_time   DateTime?
  starting_point String    @db.VarChar(255)
  starting_lat   Float?
  starting_lon   Float?
  school_id      Int

  school school @relation(fields: [school_id], references: [id])
  team   team[]
}

model team {
  id       Int    @id @default(autoincrement())
  driver_id Int
  trip_id  Int?
  name     String @db.VarChar(255)

  driver       user @relation("driver_teams", fields: [driver_id], references: [id])
  trip         trip? @relation(fields: [trip_id], references: [id])
  student_team student_team[]
}

model student_team {
  student_id Int
  team_id    Int

  student student @relation(fields: [student_id], references: [id])
  team    team    @relation(fields: [team_id], references: [id])

  @@id([student_id, team_id])
}
